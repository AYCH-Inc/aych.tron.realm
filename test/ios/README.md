# On-Target Unit-Testing [iOS]

In order to test core on device, we need an iOS app, and hence an XCode
project.

Since the test files can be expected to be changed more quickly than the
contents of this subdirectory, we use GYP to generate fresh XCode projects.
(See also the build-test-ios-app target in build.sh.)

The XCode project can then be "tested" to run the tests on device, using either
XCode, xcodebuild (see also the test-ios-app target in build.sh), Instruments,
or (the command-line) instruments (see also the leak-test-ios-app target in
build.sh).

## Implementation Details

The contents of the template subdirectory is used to generate an app
subdirectory containing the iOS app, i.e. an App and AppTests sub-subdirectory
+ project files.

To get everything to be fully automatic we use a couple dirty tricks:

* We have both an App and a AppTests target, which allows us to define a test
scheme - necessary to use xcodebuild test. The scheme is built by grep'ing the
project file generated by gyp, and by using the template App.scheme.sh. The
test target, i.e. AppTests subdirectory is used for little else than this.

* We call the tests from AppDelegate.mm, when the app has finished
loading. The app has finished loading whenever it is started the usual way,
using an inspector, or using a test scheme.

* We also redirect the XML output to standard out since there is seemingly no
easy way of fetching XML files from an iOS device.

Note, the tests are run (seemingly) multiple times. They are really run once
for each target architecture. At the time of writing, this is armv7, armv7s,
arm64. We have thus far failed to figure out a way to report the target
architecture to stdout before or after we test for a particular target
architecture. We've posted a question about this on StackOverflow:
http://stackoverflow.com/questions/23934862/.
