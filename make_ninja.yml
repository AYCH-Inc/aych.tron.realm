header_units:
  - /usr/include/:
    - c++/v1:
      - algorithm
      - array
      - atomic
        # - cassert
      - cctype
      - cerrno
      - cfloat
      - chrono
      - cinttypes
      - climits
      - clocale
      - cmath
      - codecvt
      - condition_variable
      - csignal
      - cstdarg
      # - cstddef # circular with type_traits??
      - cstdint
      - cstdio
      - cstdlib
      - cstring
      - ctime
      - cwchar
      - deque
      - exception
      - filesystem
      - fstream
      - functional
      - future
      - initializer_list
      - iomanip
      - iosfwd
      - iostream
      - istream
      - iterator
      - limits
      - list
      - locale
      - map
      - memory
      - mutex
      - new
      - numeric
      - ostream
      - optional
      - queue
      - random
      - regex
      - set
      - sstream
      - stack
      - stdexcept
      - streambuf
      - string_view
      - string
      - system_error
      - thread
      - tuple
      - typeinfo
      - type_traits
      - unordered_map
      - unordered_set
      - utility
      - vector
      - version
  - src/:
    - external:
      - pegtl/include:
        - tao/pegtl.hpp
        - tao/pegtl/uint64.hpp
        - tao/pegtl/utf8.hpp
        - tao/pegtl/tracking_mode.hpp
        - tao/pegtl/analyze.hpp
        - tao/pegtl/internal/rep.hpp
        - tao/pegtl/internal/skip_control.hpp
        - tao/pegtl/internal/cstream_reader.hpp
        - tao/pegtl/internal/action.hpp
        - tao/pegtl/internal/opt.hpp
        - tao/pegtl/internal/cr_eol.hpp
        - tao/pegtl/internal/identifier.hpp
        - tao/pegtl/internal/pad.hpp
        - tao/pegtl/internal/peek_mask_uint.hpp
        - tao/pegtl/internal/three.hpp
        - tao/pegtl/internal/peek_uint8.hpp
        - tao/pegtl/internal/raise.hpp
        - tao/pegtl/internal/if_must_else.hpp
        - tao/pegtl/internal/seq.hpp
        - tao/pegtl/internal/bump_help.hpp
        - tao/pegtl/internal/sor.hpp
        - tao/pegtl/internal/rule_conjunction.hpp
          #- tao/pegtl/internal/endian_win.hpp
        - tao/pegtl/internal/try_catch_type.hpp
        - tao/pegtl/internal/rep_min_max.hpp
        - tao/pegtl/internal/any.hpp
        - tao/pegtl/internal/discard.hpp
        - tao/pegtl/internal/demangle_sanitise.hpp
          #- tao/pegtl/internal/endian_gcc.hpp
        - tao/pegtl/internal/endian.hpp
        - tao/pegtl/internal/list_tail.hpp
        - tao/pegtl/internal/plus.hpp
        - tao/pegtl/internal/star.hpp
        - tao/pegtl/internal/demangle.hpp
        - tao/pegtl/internal/not_at.hpp
        - tao/pegtl/internal/bof.hpp
        - tao/pegtl/internal/rules.hpp
        - tao/pegtl/internal/apply0_single.hpp
        - tao/pegtl/internal/trivial.hpp
        - tao/pegtl/internal/has_apply0.hpp
        - tao/pegtl/internal/apply_single.hpp
        - tao/pegtl/internal/read_uint.hpp
        - tao/pegtl/internal/if_apply.hpp
        - tao/pegtl/internal/demangle_cxxabi.hpp
        - tao/pegtl/internal/pad_opt.hpp
        - tao/pegtl/internal/cr_crlf_eol.hpp
        - tao/pegtl/internal/action_input.hpp
        - tao/pegtl/internal/dusel_mode.hpp
        - tao/pegtl/internal/until.hpp
        - tao/pegtl/internal/crlf_eol.hpp
        - tao/pegtl/internal/peek_utf16.hpp
        - tao/pegtl/internal/cstring_reader.hpp
        - tao/pegtl/internal/apply0.hpp
        - tao/pegtl/internal/require.hpp
        - tao/pegtl/internal/file_mapper.hpp
        - tao/pegtl/internal/two.hpp
        - tao/pegtl/internal/istream_reader.hpp
        - tao/pegtl/internal/ranges.hpp
        - tao/pegtl/internal/bump_impl.hpp
        - tao/pegtl/internal/alpha.hpp
        - tao/pegtl/internal/string.hpp
        - tao/pegtl/internal/duseltronik.hpp
        - tao/pegtl/internal/peek_mask_uint8.hpp
        - tao/pegtl/internal/eolf.hpp
        - tao/pegtl/internal/rep_min.hpp
          # - tao/pegtl/internal/pegtl_string.hpp
        - tao/pegtl/internal/star_must.hpp
        - tao/pegtl/internal/disable.hpp
        - tao/pegtl/internal/file_reader.hpp
        - tao/pegtl/internal/lf_eol.hpp
        - tao/pegtl/internal/result_on_found.hpp
        - tao/pegtl/internal/demangle_nop.hpp
        - tao/pegtl/internal/alnum.hpp
        - tao/pegtl/internal/bytes.hpp
        - tao/pegtl/internal/peek_char.hpp
        - tao/pegtl/internal/eof.hpp
        - tao/pegtl/internal/bol.hpp
        - tao/pegtl/internal/list_tail_pad.hpp
        - tao/pegtl/internal/if_then_else.hpp
        - tao/pegtl/internal/peek_utf32.hpp
        - tao/pegtl/internal/enable.hpp
        - tao/pegtl/internal/lf_crlf_eol.hpp
        - tao/pegtl/internal/istring.hpp
        - tao/pegtl/internal/peek_utf8.hpp
        - tao/pegtl/internal/apply.hpp
        - tao/pegtl/internal/must.hpp
        - tao/pegtl/internal/rep_opt.hpp
        - tao/pegtl/internal/at.hpp
        - tao/pegtl/internal/marker.hpp
        - tao/pegtl/internal/file_opener.hpp
        - tao/pegtl/internal/range.hpp
        - tao/pegtl/internal/eol.hpp
        - tao/pegtl/internal/peek_uint.hpp
        - tao/pegtl/internal/minus.hpp
        - tao/pegtl/internal/iterator.hpp
        - tao/pegtl/internal/one.hpp
        - tao/pegtl/internal/has_apply.hpp
        - tao/pegtl/internal/state.hpp
        - tao/pegtl/internal/input_pair.hpp
        - tao/pegtl/internal/integer_sequence.hpp
        - tao/pegtl/internal/list.hpp
        - tao/pegtl/internal/control.hpp
        - tao/pegtl/internal/if_must.hpp
        - tao/pegtl/internal/list_must.hpp
        - tao/pegtl/uint8.hpp
        - tao/pegtl/normal.hpp
        - tao/pegtl/contrib/unescape.hpp
        - tao/pegtl/contrib/rep_one_min_max.hpp
        - tao/pegtl/contrib/to_string.hpp
        - tao/pegtl/contrib/uri.hpp
        - tao/pegtl/contrib/integer.hpp
        - tao/pegtl/contrib/tracer.hpp
        - tao/pegtl/contrib/raw_string.hpp
        - tao/pegtl/contrib/icu/utf8.hpp
        - tao/pegtl/contrib/icu/utf32.hpp
        - tao/pegtl/contrib/icu/utf16.hpp
        - tao/pegtl/contrib/icu/internal.hpp
        - tao/pegtl/contrib/http.hpp
        - tao/pegtl/contrib/parse_tree.hpp
        - tao/pegtl/contrib/alphabet.hpp
        - tao/pegtl/contrib/abnf.hpp
        - tao/pegtl/contrib/changes.hpp
        - tao/pegtl/contrib/json.hpp
        - tao/pegtl/contrib/counter.hpp
        - tao/pegtl/file_input.hpp
        - tao/pegtl/config.hpp
        - tao/pegtl/utf32.hpp
        - tao/pegtl/rules.hpp
        - tao/pegtl/string_input.hpp
        - tao/pegtl/buffer_input.hpp
        - tao/pegtl/input_error.hpp
        - tao/pegtl/apply_mode.hpp
        - tao/pegtl/uint32.hpp
        - tao/pegtl/utf16.hpp
        - tao/pegtl/memory_input.hpp
        - tao/pegtl/uint16.hpp
        - tao/pegtl/nothing.hpp
        - tao/pegtl/rewind_mode.hpp
        - tao/pegtl/analysis/rule_info.hpp
        - tao/pegtl/analysis/generic.hpp
        - tao/pegtl/analysis/insert_rules.hpp
        - tao/pegtl/analysis/counted.hpp
        - tao/pegtl/analysis/grammar_info.hpp
        - tao/pegtl/analysis/analyze_cycles.hpp
        - tao/pegtl/analysis/rule_type.hpp
        - tao/pegtl/analysis/insert_guard.hpp
        - tao/pegtl/mmap_input.hpp
        - tao/pegtl/ascii.hpp
        - tao/pegtl/istream_input.hpp
        - tao/pegtl/parse.hpp
        - tao/pegtl/cstream_input.hpp
        - tao/pegtl/parse_error.hpp
        - tao/pegtl/argv_input.hpp
        - tao/pegtl/read_input.hpp
        - tao/pegtl/eol_pair.hpp
        - tao/pegtl/eol.hpp
        - tao/pegtl/position.hpp
        - tao/pegtl/version.hpp

    - realm:
      # REALM_INSTALL_GENERAL_HEADERS
      - alloc.hpp
      - alloc_slab.hpp
      - array.hpp
      - array_basic.hpp
        # - array_basic_tpl.hpp
      - array_binary.hpp
      - array_blob.hpp
      - array_blobs_big.hpp
      - array_direct.hpp
      - array_integer.hpp
      - array_string.hpp
      - array_string_long.hpp
      - binary_data.hpp
      - bptree.hpp
      - column.hpp
      - column_backlink.hpp
      - column_binary.hpp
      - column_fwd.hpp
      - column_link.hpp
      - column_linkbase.hpp
      - column_linklist.hpp
      - column_mixed.hpp
        # - column_mixed_tpl.hpp
      - column_string.hpp
      - column_string_enum.hpp
      - column_table.hpp
      - column_timestamp.hpp
        # - column_tpl.hpp
      - column_type.hpp
      - column_type_traits.hpp
      - data_type.hpp
      - descriptor.hpp
      - descriptor_fwd.hpp
      - disable_sync_to_disk.hpp
      - exceptions.hpp
      - group.hpp
      - group_shared.hpp
      - group_shared_options.hpp
      - group_writer.hpp
      - handover_defs.hpp
      - history.hpp
      - index_string.hpp
      - lang_bind_helper.hpp
      - link_view.hpp
      - link_view_fwd.hpp
      - mixed.hpp
      - null.hpp
      - olddatetime.hpp
      - owned_data.hpp
      - query.hpp
      - query_conditions.hpp
      - query_engine.hpp
      - query_expression.hpp
      - query_operators.hpp
        #- realm_nmmintrin.h
      - replication.hpp
      - row.hpp
      - spec.hpp
      - string_data.hpp
      - table.hpp
      - table_ref.hpp
      - table_view.hpp
      - timestamp.hpp
      - unicode.hpp
      - utilities.hpp
      - version.hpp
      - version_id.hpp
      - views.hpp

      # REALM_INSTALL_IMPL_HEADERS
      - impl/array_writer.hpp
      - impl/cont_transact_hist.hpp
      - impl/destroy_guard.hpp
      - impl/input_stream.hpp
      - impl/output_stream.hpp
      - impl/sequential_getter.hpp
      - impl/simulated_failure.hpp
      - impl/transact_log.hpp

      # REALM_INSTALL_UTIL_HEADERS
      - util/allocator.hpp
      - util/any.hpp
      - util/assert.hpp
      - util/backtrace.hpp
      - util/base64.hpp
      - util/basic_system_errors.hpp
      - util/bind_ptr.hpp
      - util/buffer.hpp
      - util/call_with_tuple.hpp
      - util/fixed_size_buffer.hpp
      - util/cf_ptr.hpp
      - util/encrypted_file_mapping.hpp
      - util/features.h
      - util/file.hpp
      - util/file_mapper.hpp
      - util/hex_dump.hpp
      - util/inspect.hpp
      - util/interprocess_condvar.hpp
      - util/interprocess_mutex.hpp
      - util/logger.hpp
      - util/memory_stream.hpp
      - util/misc_errors.hpp
      - util/miscellaneous.hpp
      - util/optional.hpp
      - util/overload.hpp
      - util/priority_queue.hpp
      - util/safe_int_ops.hpp
      - util/serializer.hpp
      - util/scope_exit.hpp
      - util/shared_ptr.hpp
      - util/string_buffer.hpp
      - util/terminate.hpp
      - util/thread.hpp
      - util/to_string.hpp
      - util/type_list.hpp
      - util/type_traits.hpp
      - util/utf8.hpp

      # REALM_METRICS_HEADERS
      - metrics/metrics.hpp
      - metrics/metric_timer.hpp
      - metrics/query_info.hpp
      - metrics/transaction_info.hpp

      # REALM_OTHER_UTIL_HEADERS
      - util/aes_cryptor.hpp
      - util/errno.hpp

      - exec/importer.hpp

      # REALM_PARSER_HEADERS
      - parser:
        - collection_operator_expression.hpp
        - expression_container.hpp
        - keypath_mapping.hpp
        - parser.hpp
        - parser_utils.hpp
        - property_expression.hpp
        - query_builder.hpp
        - subquery_expression.hpp
        - value_expression.hpp

  - test:
    - fuzz_group.hpp
    - pthread_test.hpp
    - test.hpp
    - test_all.hpp
    - test_string_types.hpp
    - test_table_helper.hpp
    - testsettings.hpp
libs:
  realm-core:
    libdeps: []
    sources:
      - src:
        - realm:
          # REALM_SOURCES
          - alloc.cpp
          - alloc_slab.cpp
          - array.cpp
          - array_binary.cpp
          - array_blob.cpp
          - array_blobs_big.cpp
          - array_integer.cpp
          - array_string.cpp
          - array_string_long.cpp
          - bptree.cpp
          - column.cpp
          - column_backlink.cpp
          - column_binary.cpp
          - column_link.cpp
          - column_link_base.cpp
          - column_linklist.cpp
          - column_mixed.cpp
          - column_string.cpp
          - column_string_enum.cpp
          - column_table.cpp
          - column_timestamp.cpp
          - descriptor.cpp
          - disable_sync_to_disk.cpp
          - exceptions.cpp
          - group.cpp
          - group_shared.cpp
          - group_writer.cpp
          - history.cpp
          - impl/output_stream.cpp
          - impl/simulated_failure.cpp
          - impl/transact_log.cpp
          - index_string.cpp
          - lang_bind_helper.cpp
          - link_view.cpp
          - query.cpp
          - query_engine.cpp
          - query_expression.cpp
          - replication.cpp
          - row.cpp
          - spec.cpp
          - string_data.cpp
          - table.cpp
          - table_view.cpp
          - unicode.cpp
          - util/allocator.cpp
          - util/backtrace.cpp
          - util/base64.cpp
          - util/basic_system_errors.cpp
          - util/encrypted_file_mapping.cpp
          - util/file.cpp
          - util/file_mapper.cpp
          - util/interprocess_condvar.cpp
          - util/logger.cpp
          - util/memory_stream.cpp
          - util/misc_errors.cpp
          - util/serializer.cpp
          - util/terminate.cpp
          - util/thread.cpp
          - util/to_string.cpp
          - utilities.cpp
          - version.cpp
          - views.cpp

          - metrics/metrics.cpp
          - metrics/metric_timer.cpp
          - metrics/query_info.cpp
          - metrics/transaction_info.cpp
  realm-parser:
    libdeps:
      - realm-core
    sources:
      - src/realm/parser:
        - expression_container.cpp
        - keypath_mapping.cpp
        - parser.cpp
        - parser_utils.cpp
        - property_expression.cpp
        - query_builder.cpp
        - subquery_expression.cpp
        - value_expression.cpp
  realm-test-util:
    libdeps:
      - realm-core
    syslibdeps:
      - rt
    sources:
      - test/util:
        - benchmark_results.cpp
        - demangle.cpp
        - mem.cpp
        - timer.cpp
        - random.cpp
        - quote.cpp
        - wildcard.cpp
        - unit_test.cpp
        - test_path.cpp
        - test_only.cpp
        - crypt_key.cpp
        - misc.cpp
        - verified_integer.cpp
        - verified_string.cpp
        - resource_limits.cpp
        - jsmn.cpp
bins:
  realm-config:
    libdeps:
      - realm-core
    sources:
      - src/realm/exec:
        - config_tool.cpp
  realm-tests:
    libdeps:
      - realm-core
      - realm-parser
      - realm-test-util
    syslibdeps:
      - procps
      - rt
    sources:
      - test:
        - main.cpp

        # NORMAL_TESTS
        - test_all.cpp
        - test_alloc.cpp
        - test_array.cpp
        - test_array_binary.cpp
        - test_array_blob.cpp
        - test_array_blobs_big.cpp
        - test_array_float.cpp
        - test_array_integer.cpp
        - test_array_string.cpp
        - test_array_string_long.cpp
        - test_basic_utils.cpp
        - test_binary_data.cpp
        - test_column.cpp
        - test_column_binary.cpp
        - test_column_float.cpp
        - test_column_mixed.cpp
        - test_column_string.cpp
        - test_column_timestamp.cpp
        - test_descriptor.cpp
        - test_destroy_guard.cpp
        - test_destructor_thread_safety.cpp
        - test_file.cpp
        - test_file_locks.cpp
        - test_group.cpp
        - test_impl_simulated_failure.cpp
        - test_index_string.cpp
        - test_json.cpp
        - test_lang_bind_helper.cpp
        - test_link_query_view.cpp
        - test_links.cpp
        - test_metrics.cpp
        - test_optional.cpp
        - test_parser.cpp
        - test_priority_queue.cpp
          #-  test_query.cpp # This test dominates compile time. Should be split up.
        - test_replication.cpp
        - test_safe_int_ops.cpp
        - test_self.cpp
        - test_shared.cpp
        - test_string_data.cpp
        - test_table.cpp
        - test_table_view.cpp
        - test_thread.cpp
        - test_transactions.cpp
        - test_transactions_lasse.cpp
        - test_upgrade_database.cpp
        - test_utf8.cpp
        - test_util_any.cpp
        - test_util_backtrace.cpp
        - test_util_base64.cpp
        - test_util_error.cpp
        - test_util_file.cpp
        - test_util_inspect.cpp
        - test_util_logger.cpp
        - test_util_memory_stream.cpp
        - test_util_overload.cpp
        - test_util_scope_exit.cpp
        - test_util_stringbuffer.cpp
        - test_util_to_string.cpp
        - test_util_type_list.cpp
        - test_util_fixed_size_buffer.cpp
        - test_version.cpp

        # LARGE_TESTS
        - large_tests/test_column_large.cpp
        - large_tests/test_strings.cpp

        # FUZZY_TESTS
        - fuzz_group.cpp

defaults:
  - realm-config
  
module_exclusions:
  - src/realm/parser/parser.cpp # for some reason this doesn't generate an operator!=() for std::__map_iterator :(
