#!/bin/bash

set -ex

# we should always set proper ownership before exiting, otherwise
# the created logs will have root:root ownership and we'll be unable
# to delete them from our host.
trap 'chown -R --reference /inside/test /test-logs/' EXIT

apt-get update
# TODO: remove the need of the force-overwrite
find /out -maxdepth 1 -name "*.deb" -exec dpkg --force-overwrite -i {} \;


# include build test here to ensure that everything is properly installed
packages=(realm-core-release-runtime realm-core-release-devel realm-core-debug-runtime realm-core-debug-devel)

for x in "${packages[@]}"; do
  echo "--- querying $x ---"
  dpkg-query -s "$x"
done
